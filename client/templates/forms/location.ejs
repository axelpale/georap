<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <h1><span id="tresdb-location-name"><%= (location.name === '' ? 'Untitled' : location.name) %></span> <button id="tresdb-location-rename-show" type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</button></h1>

      <form id="tresdb-location-rename-form" class="hidden panel panel-primary">
        <div class="panel-body">
          <div class="form-group">
            <label for="tresdb-location-rename-input">New name:</label>
            <input type="text" class="form-control" id="tresdb-location-rename-input">
          </div>
          <button id="tresdb-location-rename-cancel" type="button" class="btn btn-default">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>

      <div id="tresdb-location-rename-error" class="hidden">
        <div class="alert alert-danger" role="alert">Renaming the location failed.</div>
      </div>

      <% var j, ts; %>
      <% ts = location.tags; %>
      <p class="tresdb-tags">
      <% for (j = 0; j < ts.length; j += 1) { %>
        <span class="label label-default"><%= ts[j] %></span>
      <% } %>
      <button id="tresdb-location-edit-tags-show" type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</button>
      </p>

      <p class="tresdb-coordinates">
        <span class="label label-default"><%= geostamp(location.geom, { precision: 5 }) %></span>
        <button id="tresdb-location-edit-coordinates-show" type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</button>
      </p>

      <p>
        <button id="tresdb-location-text" type="button" class="btn btn-default"><span class="glyphicon glyphicon-comment"></span> Write</button>
        <button id="tresdb-location-photo" type="button" class="btn btn-default"><span class="glyphicon glyphicon-paperclip"></span> Upload</button>
        <button id="tresdb-location-visit" type="button" class="btn btn-default"><span class="glyphicon glyphicon-star"></span> Visit</button>
      </p>

      <% var i, cs, c; %>
      <% cs = location.content; %>
      <% for (i = 0; i < cs.length; i += 1) { %>
        <% c = cs[i]; %>
      <div class="panel panel-default tresdb-content-<%= c.type %>">
        <% if (c.type === 'story') { %>
          <div class="panel-heading">
            <%= c.user %> wrote <%= timestamp(c.time) %>
          </div>
          <div class="panel-body">
          <%= marked(c.data.markdown, { sanitize: true }) %>
          </div>
        <% } else if (c.type === 'created') { %>
          <div class="panel-heading">
            <%= c.user %> created <em><%= location.name %></em> <%= timestamp(c.time) %>
          </div>
        <% } else if (c.type === 'visit') { %>
          <div class="panel-heading">
            <%= c.user %> visited <em><%= location.name %></em> <%= timestamp(c.time) %>
          </div>
        <% } else if (c.type === 'rename') { %>
          <div class="panel-heading">
            <%= c.user %> renamed <em><%= c.data.oldName %></em> to <em><%= c.data.newName %></em> <%= timestamp(c.time) %>
          </div>
        <% } else if (c.type === 'attachment') { %>
          <div class="panel-heading">
            <%= c.user %> uploaded <%= timestamp(c.time) %>
          </div>
          <% if (c.data.mimetype.startsWith('image')) { %>
            <div class="panel-body tresdb-content-attachment-image-body">
              <a href="<%= c.data.url %>" target="_blank"><img src="<%= c.data.url %>"></a>
            </div>
          <% } else { %>
            <div class="panel-body">
              <a href="<%= c.data.url %>" target="_blank"><%= c.data.filename %></a>
            </div>
          <% } %>
        <% } %>
      </div>
      <% } %>

    </div>
  </div>
</div>
